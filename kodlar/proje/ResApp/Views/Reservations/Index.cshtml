@model IEnumerable<ResApp.Models.Reservation>
@{
    ViewData["Title"] = "Rezervasyonlarım";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1>Rezervasyonlarım</h1>
        <p class="text-muted">Aktif, tamamlanan ve iptal edilen tüm rezervasyonlarınızı görüntüleyin.</p>
    </div>
    <a asp-controller="Books" asp-action="Index" class="btn btn-outline-primary">Yeni Rezervasyon</a>
</div>

@if (TempData["SuccessMessage"] is string successMessage)
{
    <div class="alert alert-success">@successMessage</div>
}
else if (TempData["ErrorMessage"] is string errorMessage)
{
    <div class="alert alert-danger">@errorMessage</div>
}

@if (!Model.Any())
{
    <div class="alert alert-info">Henüz bir rezervasyonunuz bulunmuyor.</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-striped align-middle">
            <thead>
                <tr>
                    <th>Kitap</th>
                    <th>Başlangıç</th>
                    <th>Bitiş</th>
                    <th>Kalan Gün</th>
                    <th>Durum</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var reservation in Model)
                {
                    var remainingDays = Math.Max(0, (reservation.EndDate.Date - DateTime.Today).Days);
                    <tr>
                        <td>@reservation.BookTitle</td>
                        <td>@reservation.StartDate.ToString("dd.MM.yyyy")</td>
                        <td>@reservation.EndDate.ToString("dd.MM.yyyy")</td>
                        <td>@remainingDays</td>
                        <td>
                            @switch (reservation.Status)
                            {
                                case ResApp.Models.ReservationStatus.Active:
                                    <span class="badge text-bg-success">Aktif</span>
                                    break;
                                case ResApp.Models.ReservationStatus.Cancelled:
                                    <span class="badge text-bg-warning">İptal Edildi</span>
                                    break;
                                default:
                                    <span class="badge text-bg-secondary">Süresi Doldu</span>
                                    break;
                            }
                        </td>
                        <td class="text-end">
                            @if (reservation.Status == ResApp.Models.ReservationStatus.Active)
                            {
                                <form asp-action="Cancel" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@reservation.Id" />
                                    <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Rezervasyonu iptal etmek istediğinize emin misiniz?');">
                                        İptal Et
                                    </button>
                                </form>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
