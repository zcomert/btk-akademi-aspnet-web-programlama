@model IEnumerable<ResApp.Models.Reservation>
@{
    ViewData["Title"] = "Rezervasyon Yönetimi";
}

<h1 class="mb-4">Tüm Rezervasyonlar</h1>

@if (TempData["SuccessMessage"] is string successMessage)
{
    <div class="alert alert-success">@successMessage</div>
}
else if (TempData["ErrorMessage"] is string errorMessage)
{
    <div class="alert alert-danger">@errorMessage</div>
}

@if (!Model.Any())
{
    <div class="alert alert-info">Sistemde kayıtlı rezervasyon bulunamadı.</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Kullanıcı</th>
                    <th>Kitap</th>
                    <th>Başlangıç</th>
                    <th>Bitiş</th>
                    <th>Kalan Gün</th>
                    <th>Durum</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var reservation in Model)
                {
                    var remainingDays = Math.Max(0, (reservation.EndDate.Date - DateTime.Today).Days);
                    <tr>
                        <td>@reservation.Id</td>
                        <td>@reservation.User?.UserName</td>
                        <td>@reservation.BookTitle</td>
                        <td>@reservation.StartDate.ToString("dd.MM.yyyy")</td>
                        <td>@reservation.EndDate.ToString("dd.MM.yyyy")</td>
                        <td>@remainingDays</td>
                        <td>@reservation.Status</td>
                        <td class="text-end">
                            @if (reservation.Status == ResApp.Models.ReservationStatus.Active)
                            {
                                <form asp-action="Cancel" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@reservation.Id" />
                                    <button type="submit" class="btn btn-outline-danger btn-sm">İptal Et</button>
                                </form>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
